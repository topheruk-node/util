[playground](https://lit.dev/playground/#project=W3sibmFtZSI6ImRydW0tc2FtcGxlci50cyIsImNvbnRlbnQiOiJpbXBvcnQgeyAgaHRtbCwgTGl0RWxlbWVudCxjc3MscmVuZGVyIH0gZnJvbSBcImxpdFwiO1xuaW1wb3J0IHsgY3VzdG9tRWxlbWVudCwgcHJvcGVydHksIHF1ZXJ5QXNzaWduZWRFbGVtZW50cywgc3RhdGUgfSBmcm9tIFwibGl0L2RlY29yYXRvcnMuanNcIjtcbmltcG9ydCB7IHdoZW4gfSBmcm9tICdsaXQvZGlyZWN0aXZlcy93aGVuLmpzJztcbmltcG9ydCB7IHJlZiwgUmVmLCBjcmVhdGVSZWYgfSBmcm9tICdsaXQvZGlyZWN0aXZlcy9yZWYuanMnO1xuaW1wb3J0IHsgZHJ1bVNhbXBsZXJTdHlsZXMgfSBmcm9tIFwiLi90ZW1wbGF0ZS1hbmQtc3R5bGVzLmpzXCJcbmltcG9ydCB7IEVmZmVjdEluc2VydCB9IGZyb20gXCIuL2VmZmVjdC1pbnNlcnQuanNcIjtcbmltcG9ydCBcIi4vZWZmZWN0LWluc2VydC5qc1wiO1xuaW1wb3J0IHsgQXVkaW9UcmFjayB9IGZyb20gJy4vYXVkaW8tdHJhY2suanMnXG5pbXBvcnQgJy4vYXVkaW8tdHJhY2suanMnIFxuXG5AY3VzdG9tRWxlbWVudChcImRydW0tc2FtcGxlclwiKVxuZXhwb3J0IGNsYXNzIERydW1TYW1wbGVyIGV4dGVuZHMgTGl0RWxlbWVudCB7XG4gIEBxdWVyeUFzc2lnbmVkRWxlbWVudHMoeyBzbG90OiBcImluc2VydFwifSkgbGlzdE9mSW5zZXJ0cyE6IEVmZmVjdEluc2VydFtdXG4gIFxuICBAcXVlcnlBc3NpZ25lZEVsZW1lbnRzKHsgc2xvdDogXCJ0cmFja1wifSkgbGlzdE9mVHJhY2tzITogQXVkaW9UcmFja1tdXG4gIFxuICBAcHJvcGVydHkoeyB0eXBlOiBCb29sZWFuIH0pIGJ1cyA9IGZhbHNlXG4gICAgICBcbiAgQHN0YXRlKCkgcGF0aCA9IFwiZGVzaW5hdGlvblwiO1xuICAgICAgICBcbiAgcHJpdmF0ZSBjdXJyZW50VHJhY2shOkF1ZGlvVHJhY2s7XG4gIFxuICBidXNUcmFja1JlZjogUmVmPEF1ZGlvVHJhY2s-ID0gY3JlYXRlUmVmKClcbiAgICAgIFxuICBmaXJzdFVwZGF0ZWQoKSB7XG4gICAgY29uc3QgYXVkaW9UcmFjayA9IHRoaXMuYnVzVHJhY2tSZWYudmFsdWUhO1xuICAgICAgdGhpcy5jdXJyZW50VHJhY2sgPSBhdWRpb1RyYWNrO1xuICAgICAgZm9yIChjb25zdCBpbnNlcnQgb2YgdGhpcy5saXN0T2ZJbnNlcnRzKSB7XG4gICAgICAgIGluc2VydC5mb3IgPSBhdWRpb1RyYWNrLm5hbWU7XG4gICAgICAgIGF1ZGlvVHJhY2suZnhzLnNldChpbnNlcnQudHlwZSwgaW5zZXJ0LnZhbHVlKTtcbiAgICB9Ly9PKG5eMilcbiAgfVxuICBcbiAgI29uVHJhY2tTbG90Q2hhbmdlKCl7XG4gICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLmxpc3RPZlRyYWNrcykge1xuICAgICAgdGhpcy5jdXJyZW50VHJhY2sgPSB0cmFjaztcbiAgICAgIGZvciAoY29uc3QgaW5zZXJ0IG9mIHRoaXMubGlzdE9mSW5zZXJ0cykge1xuICAgICAgICBpbnNlcnQuZm9yID0gdHJhY2submFtZTtcbiAgICAgICAgdHJhY2suZnhzLnNldChpbnNlcnQudHlwZSwgaW5zZXJ0LnZhbHVlKTtcbiAgICAgIH07XG4gICAgfS8vTyhuXjIpXG4gIH1cbiAgICAgIFxuICAjb25DYWNoZVZhbHVlKGU6IEV2ZW50KXtcbiAgICBsZXQgdGFyZ2V0ID0gZS50YXJnZXQgYXMgRWZmZWN0SW5zZXJ0XG4gICAgdGhpcy5jdXJyZW50VHJhY2suZnhzLnNldCh0YXJnZXQudHlwZSwgdGFyZ2V0LnZhbHVlKTtcbiAgfVxuXG4gICNvblBsYXliYWNrKGU6IEV2ZW50KXtcbiAgICBsZXQgdGFyZ2V0ID0gZS50YXJnZXQgYXMgQXVkaW9UcmFja1xuICAgIHRoaXMucGF0aCA9IFwiXCJcbiAgICAgICAgXG4vLyAgICAgVE9ETyAtIGFkZCBidXNUcmFjayBpbnNlcnRzICAgIFxuICAgIGxldCBhdWRpb05vZGVzID0gdGhpcy5saXN0T2ZJbnNlcnRzLmZsYXRNYXAoaW5zZXJ0ID0-IHtcbiAgICAgIChpbnNlcnQuZm9yID09PSB0YXJnZXQubmFtZSkgXG4gICAgICA_IHRhcmdldC5meHMuc2V0KGluc2VydC50eXBlLCBpbnNlcnQudmFsdWUpIFxuICAgICAgOiB0aGlzLmN1cnJlbnRUcmFjayA9IHRhcmdldDtcbiAgICAgIFxuICAgICAgaW5zZXJ0LnZhbHVlID0gdGFyZ2V0LmZ4cy5nZXQoaW5zZXJ0LnR5cGUpID8_IDA7ICAgIFxuICAgICAgcmV0dXJuIGAke2luc2VydC5mb3IgPSB0YXJnZXQubmFtZX06JHtpbnNlcnQudHlwZX1gXG4gICAgfSlcbiAgICBcbiAgICB0aGlzLnBhdGggPSBbdGFyZ2V0Lm5hbWUsLi4uYXVkaW9Ob2RlcyxcImRlc3RpbmF0aW9uXCJdLmpvaW4oXCIgLS0-IFwiKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGxldCBidXMgPSBodG1sYFxuICAgICAgICA8YXVkaW8tdHJhY2tcbiAgICAgICAgICAke3JlZih0aGlzLmJ1c1RyYWNrUmVmKX1cbiAgICAgICAgICBAcGxheS1iYWNrPSR7dGhpcy4jb25QbGF5YmFja31cbiAgICAgICAgbmFtZT1cImJ1c1wiLz5gXG4gICAgcmV0dXJuIGh0bWxgXG4gICAgICAke3doZW4odGhpcy5idXMsKCkgPT4gYnVzKX1cbiAgICAgIDxzbG90XG4gICAgICAgIEBjYWhjZS12YWx1ZT0ke3RoaXMuI29uQ2FjaGVWYWx1ZX1cbiAgICAgIG5hbWU9XCJpbnNlcnRcIj48L3Nsb3Q-XG4gICAgICA8c2xvdCBcbiAgICAgICAgQHBsYXktYmFjaz0ke3RoaXMuI29uUGxheWJhY2t9XG4gICAgICAgIEBzbG90Y2hhbmdlPSR7dGhpcy4jb25UcmFja1Nsb3RDaGFuZ2V9XG4gICAgICBuYW1lPVwidHJhY2tcIj48L3Nsb3Q-XG4gICAgICBhdWRpbyBwYXRoOiAke3RoaXMucGF0aH1cbiAgICBgOyAgICBcbiAgfVxuXG4gIHN0YXRpYyBzdHlsZXMgPSBkcnVtU2FtcGxlclN0eWxlc1xufVxuXG4ifSx7Im5hbWUiOiJpbmRleC5odG1sIiwiY29udGVudCI6IjwhRE9DVFlQRSBodG1sPlxuPGhlYWQ-XG4gIDxzY3JpcHQgdHlwZT1cIm1vZHVsZVwiIHNyYz1cIi4vZHJ1bS1zYW1wbGVyLmpzXCI-PC9zY3JpcHQ-XG48IS0tICAgPHNjcmlwdCB0eXBlPVwibW9kdWxlXCIgc3JjPVwiLi9hdWRpby10cmFjay5qc1wiPjwvc2NyaXB0PiAtLT5cbjwhLS0gICA8c2NyaXB0IHR5cGU9XCJtb2R1bGVcIiBzcmM9XCIuL2VmZmVjdC1pbnNlcnQuanNcIj48L3NjcmlwdD4gLS0-XG48L2hlYWQ-XG48Ym9keT5cbiAgPGRydW0tc2FtcGxlciBidXM-XG4gICAgPGVmZmVjdC1pbnNlcnQgc2xvdD1cImluc2VydFwiIHR5cGU9XCJnYWluXCIgdmFsdWU9XCI4MFwiPjwvZWZmZWN0LWluc2VydD5cbiAgICA8ZWZmZWN0LWluc2VydCBzbG90PVwiaW5zZXJ0XCIgdHlwZT1cInBhblwiIHZhbHVlPVwiNjBcIj48L2VmZmVjdC1pbnNlcnQ-XG4gICAgPGF1ZGlvLXRyYWNrIHNsb3Q9XCJ0cmFja1wiIG5hbWU9XCJraWNrXCI-PC9hdWRpby10cmFjaz5cbiAgICA8YXVkaW8tdHJhY2sgc2xvdD1cInRyYWNrXCIgbmFtZT1cInNuYXJlXCI-PC9hdWRpby10cmFjaz4gXG4gIDwvZHJ1bS1zYW1wbGVyPlxuPC9ib2R5PlxuIn0seyJuYW1lIjoicGFja2FnZS5qc29uIiwiY29udGVudCI6IntcbiAgXCJkZXBlbmRlbmNpZXNcIjoge1xuICAgIFwibGl0XCI6IFwiXjIuMC4wXCIsXG4gICAgXCJAbGl0L3JlYWN0aXZlLWVsZW1lbnRcIjogXCJeMS4wLjBcIixcbiAgICBcImxpdC1lbGVtZW50XCI6IFwiXjMuMC4wXCIsXG4gICAgXCJsaXQtaHRtbFwiOiBcIl4yLjAuMFwiXG4gIH1cbn0iLCJoaWRkZW4iOnRydWV9LHsibmFtZSI6ImVmZmVjdC1pbnNlcnQudHMiLCJjb250ZW50IjoiaW1wb3J0IHsgIGh0bWwsIExpdEVsZW1lbnQgfSBmcm9tIFwibGl0XCI7XG5pbXBvcnQgeyBjdXN0b21FbGVtZW50LCBwcm9wZXJ0eSB9IGZyb20gXCJsaXQvZGVjb3JhdG9ycy5qc1wiO1xuaW1wb3J0IHsgZWZmZWN0SW5zZXJ0U3R5bGVzIH0gZnJvbSBcIi4vdGVtcGxhdGUtYW5kLXN0eWxlcy5qc1wiO1xuXG5cbkBjdXN0b21FbGVtZW50KFwiZWZmZWN0LWluc2VydFwiKVxuZXhwb3J0IGNsYXNzIEVmZmVjdEluc2VydCBleHRlbmRzIExpdEVsZW1lbnQge1xuICBAcHJvcGVydHkoKSB0eXBlID0gXCJlZmZlY3RcIiAgICAgICAgICAgIC8vdHlwZSBFZmZlY3QgPSBcImdhaW5cIiB8IFwicGFuXCIgfCBcImhpZ2hwYXNzXCIgfCBcImxvd3Bhc3NcIlxuICBcbiAgQHByb3BlcnR5KHsgdHlwZTogTnVtYmVyIH0pIHZhbHVlID0gMDsgLy90eXBlIHN0cmluZ1xuICBcbiAgQHByb3BlcnR5KCkgZm9yID0gXCJ0cmFja1wiICAgICAgICAgICAgICAvL3R5cGUgc3RyaW5nXG4gIFxuICAjb25JbnB1dChlOiBFdmVudCl7XG4gICAgdGhpcy52YWx1ZSA9IChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZUFzTnVtYmVyXG4gIH1cbiAgIFxuICAjb25Gb28oZTogRXZlbnQpe1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJjYWhjZS12YWx1ZVwiLCB7ZGV0YWlsOiB0aGlzLCBidWJibGVzOiB0cnVlLCBjb21wb3NlZDogdHJ1ZX0pKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiBodG1sYFxuICAgICAgPGxhYmVsIHN0eWxlPVwiZ3JpZC1hcmVhOiBhXCI-JHt0aGlzLnR5cGV9IC0gJHt0aGlzLmZvcn08L2xhYmVsPlxuICAgICAgPGlucHV0IHN0eWxlPVwiZ3JpZC1hcmVhOiBjXCJcbiAgICAgICAgQGlucHV0PSR7dGhpcy4jb25JbnB1dH1cbiAgICAgICAgQHBvaW50ZXJ1cD0ke3RoaXMuI29uRm9vfVxuICAgICAgICAudmFsdWU9JHt0aGlzLnZhbHVlfVxuICAgICAgdHlwZT1cInJhbmdlXCI-XG4gICAgICA8b3V0cHV0IHN0eWxlPVwiZ3JpZC1hcmVhOiBiXCI-JHt0aGlzLnZhbHVlfTwvb3V0cHV0PlxuICAgIGA7XG4gIH1cblxuICBzdGF0aWMgc3R5bGVzID0gZWZmZWN0SW5zZXJ0U3R5bGVzXG59XG5cbiJ9LHsibmFtZSI6ImF1ZGlvLXRyYWNrLnRzIiwiY29udGVudCI6ImltcG9ydCB7ICBodG1sLCBMaXRFbGVtZW50IH0gZnJvbSBcImxpdFwiO1xuaW1wb3J0IHsgY3VzdG9tRWxlbWVudCwgcHJvcGVydHkgfSBmcm9tIFwibGl0L2RlY29yYXRvcnMuanNcIjtcbmltcG9ydCB7IGF1ZGlvVHJhY2tTdHlsZXMgfSBmcm9tIFwiLi90ZW1wbGF0ZS1hbmQtc3R5bGVzLmpzXCI7XG5cbkBjdXN0b21FbGVtZW50KFwiYXVkaW8tdHJhY2tcIilcbmV4cG9ydCBjbGFzcyBBdWRpb1RyYWNrIGV4dGVuZHMgTGl0RWxlbWVudCB7XG4gIEBwcm9wZXJ0eSgpIG5hbWUgPSBcInRyYWNrXCIgLy90eXBlIHN0cmluZ1xuICBcbiAgQHByb3BlcnR5KCkgbW9kZSA9IFwic29sb1wiICAvL3R5cGUgTW9kZSA9IFwic29sb1wiIHwgXCJncm91cFwiIC0gVE9ETyBtYXkgbm90IGJlIHJlcXVpcmVkXG4gIFxuICBAcHJvcGVydHkoKSBzcmMgPSBcIlwiXG4gICAgICBcbiAgZnhzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKVxuICAgICAgXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gaHRtbGBcbiAgICAgIDxidXR0b25cbiAgICAgICAgQHBvaW50ZXJkb3duPSR7KCkgPT4gdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcInBsYXktYmFja1wiLCB7ZGV0YWlsOiB0aGlzLCBidWJibGVzOiB0cnVlLCBjb21wb3NlZDogdHJ1ZX0pKX1cbiAgICAgID5cbiAgICAgICAgJHt0aGlzLm5hbWV9XG4gICAgICA8L2J1dHRvbj5cbiAgICBgO1xuICB9XG4gIFxuICBzdGF0aWMgc3R5bGVzID0gYXVkaW9UcmFja1N0eWxlc1xufVxuXG4ifSx7Im5hbWUiOiJ0ZW1wbGF0ZS1hbmQtc3R5bGVzLnRzIiwiY29udGVudCI6ImltcG9ydCB7IGNzcyB9IGZyb20gXCJsaXRcIjtcblxuZXhwb3J0IGNvbnN0IGVmZmVjdFR5cCA9IFtcImdhaW5cIixcInBhblwiLFwiaGlnaHBhc3NcIixcImxvd3Bhc3NcIl0gYXMgY29uc3RcbmV4cG9ydCB0eXBlIEVmZmVjdFR5cCA9IHR5cGVvZiBlZmZlY3RUeXBbbnVtYmVyXVxuICAgIFxuZXhwb3J0IGNvbnN0IG1vZGVUeXAgPSBbXCJzb2xvXCIsXCJncm91cFwiXSBhcyBjb25zdFxuZXhwb3J0IHR5cGUgTW9kZVR5cCA9IHR5cGVvZiBtb2RlVHlwW251bWJlcl1cblxuZXhwb3J0IGNvbnN0IGRydW1TYW1wbGVyU3R5bGVzID0gY3NzYFxuOmhvc3Qge1xuICAgIHdpZHRoOiBjYWxjKDQqNTBweCk7XG4gICAgaGVpZ2h0OiBjYWxjKDYqNTBweCk7XG4gICAgZGlzcGxheTogZ3JpZDtcbn1cbiAgICBcbnNsb3RbbmFtZT1idXNde1xuICAgIGRpc3BsYXk6IGZsZXg7XG59XG5cbnNsb3RbbmFtZT10cmFja117XG4gICAgZGlzcGxheTogZ3JpZDtcbiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCg0LCA1MHB4KTtcbiAgICBncmlkLXRlbXBsYXRlLXJvd3M6IHJlcGVhdCgyLDFmcik7XG4gICAgZ2FwOiAxZnI7XG59XG5cbnNsb3RbbmFtZT1pbnNlcnRde1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICB3aWR0aDogNzVweDtcbn1cbmBcblxuZXhwb3J0IGNvbnN0IGF1ZGlvVHJhY2tTdHlsZXMgPSBjc3NgXG46aG9zdCB7XG4gIC0tc2l6ZTogNDhweFxufVxuYnV0dG9uIHtcbiAgd2lkdGg6IHZhcigtLXNpemUpO1xuICBoZWlnaHQ6IHZhcigtLXNpemUpO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiBub25lO1xufVxuYCAgICBcbiAgICBcbmV4cG9ydCBjb25zdCBlZmZlY3RJbnNlcnRTdHlsZXMgPSBjc3NgXG46aG9zdCB7XG4gICAgZGlzcGxheTogZ3JpZDtcbiAgICBncmlkLXRlbXBsYXRlLWFyZWFzOiBcImEgYlwiIFwiYyBjXCJcbn1cbmAifV0)